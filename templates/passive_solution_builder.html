{% extends 'base.html' %}
{% block title %}Passive "Copper" Solution Builder{% endblock %}

{% block content %}
<style>
    .card { border: none; border-radius: 12px; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.07); }
    .card-header { background-color: #ffffff; border-bottom: 1px solid #e9ecef; font-weight: 600; font-size: 1.25rem; padding: 1.5rem; }
    .card-body { padding: 2rem; }
    .table thead th { background-color: #f8f9fa; border-bottom-width: 2px; font-weight: 600; }
    .custom-file-label::after { content: "Browse"; }
    .section-title {
        font-weight: 600;
        color: #343a40;
        margin-top: 1.5rem;
        margin-bottom: 1rem;
        border-bottom: 1px solid #e9ecef;
        padding-bottom: 0.5rem;
    }
</style>

<div class="container" style="max-width: 900px;">
    <div class="card">
        <div class="card-header"><i class="fas fa-magic mr-2"></i>Passive "Copper" Solution Builder</div>
        <div class="card-body">
            <h5 class="card-title">Project Requirements</h5>
            <p class="text-muted">Enter the project details and upload the points distribution file to generate a Bill of Quantities.</p>

            <form method="POST" enctype="multipart/form-data">

                <h6 class="section-title">Step 1: Upload Excel File</h6>
                <div class="alert alert-info">
                    <strong>Note:</strong> Your Excel file must contain columns with headers like `Total Points per rack`, `Copper patch panel 24 port`, etc.
                </div>
                <div class="form-group">
                    <label for="boq_file"><strong>Select Excel File</strong></label>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" id="boq_file" name="boq_file" required accept=".xlsx, .xls">
                        <label class="custom-file-label" for="boq_file">Choose file...</label>
                    </div>
                </div>

                <h6 class="section-title">Step 2: Enter Project Requirements</h6>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label><strong>Cable Category</strong></label>
                        <div>
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" id="cat6" name="cable_category" value="Cat6" class="custom-control-input" checked>
                                <label class="custom-control-label" for="cat6">Cat6</label>
                            </div>
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" id="cat6a" name="cable_category" value="Cat6A" class="custom-control-input">
                                <label class="custom-control-label" for="cat6a">Cat6A</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="avg_copper_length"><strong>Average Cable Length (m)</strong> <small class="text-muted">(Optional)</small></label>
                        <input type="number" class="form-control" id="avg_copper_length" name="avg_copper_length" placeholder="Default: 45">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-6"><label for="num_single_faceplates">Number of Single Faceplates</label><input type="number" class="form-control" id="num_single_faceplates" name="num_single_faceplates" value="0" required></div>
                    <div class="form-group col-md-6"><label for="num_double_faceplates">Number of Double Faceplates</label><input type="number" class="form-control" id="num_double_faceplates" name="num_double_faceplates" value="0" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-6"><label for="num_floor_boxes">Number of Floor Box Outlets</label><input type="number" class="form-control" id="num_floor_boxes" name="num_floor_boxes" value="0" required></div>
                    <div class="form-group col-md-6"><label for="num_devices_no_fp">Devices without Faceplates</label><input type="number" class="form-control" id="num_devices_no_fp" name="num_devices_no_fp" value="0" required></div>
                </div>

                <button type="submit" class="btn btn-primary mt-3"><i class="fas fa-cogs mr-2"></i>Build Copper Solution</button>
            </form>
        </div>
    </div>

    {% if results is not none %}
    <div class="card mt-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span><i class="fas fa-clipboard-list mr-2"></i>Generated Bill of Quantities</span>
            {% if results %}
            <a href="{{ url_for('download_boq') }}" class="btn btn-success btn-sm">
                <i class="fas fa-file-excel mr-1"></i> Download BoQ
            </a>
            {% endif %}
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped mb-0">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Item</th>
                            <th>Calculated Quantity</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in results %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td><strong>{{ item.item }}</strong></td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.notes }}</td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" class="text-center p-4">No data could be calculated. Please check the input file and requirements.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    document.querySelector('.custom-file-input').addEventListener('change', function (e) {
        var fileName = document.getElementById("boq_file").files[0].name;
        var nextSibling = e.target.nextElementSibling;
        nextSibling.innerText = fileName;
    });
</script>
{% endblock %}